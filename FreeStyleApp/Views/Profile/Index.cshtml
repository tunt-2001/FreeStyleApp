@{
    ViewData["Title"] = "Hồ sơ của tôi";
}

<h1 class="h3 mb-4 text-gray-800">@ViewData["Title"]</h1>

<div class="row">
    <div class="col-lg-6">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Thông tin tài khoản</h6>
            </div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-4">Tên đăng nhập:</dt>
                    <dd class="col-sm-8">@(User.Identity?.Name ?? "N/A")</dd>

                    <dt class="col-sm-4">Họ và tên:</dt>
                    <dd class="col-sm-8">@User.FindFirst("UserFullName")?.Value</dd>
                </dl>
            </div>
        </div>
    </div>
    <div class="col-lg-6">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Đổi mật khẩu</h6>
            </div>
            <div class="card-body">
                <form id="changePasswordForm">
                    <div class="mb-3">
                        <label class="form-label">Mật khẩu cũ</label>
                        <input type="password" id="oldPassword" class="form-control" required autocomplete="current-password" />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Mật khẩu mới</label>
                        <input type="password" id="newPassword" class="form-control" required autocomplete="new-password" />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Xác nhận mật khẩu mới</label>
                        <input type="password" id="confirmPassword" class="form-control" required autocomplete="new-password" />
                    </div>
                    <button type="submit" class="btn btn-primary">Lưu thay đổi</button>
                </form>
            </div>
        </div>
    </div>
</div>


@section Scripts {
    <script>
        document.getElementById('changePasswordForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const data = {
                oldPassword: document.getElementById('oldPassword').value,
                newPassword: document.getElementById('newPassword').value,
                confirmPassword: document.getElementById('confirmPassword').value,
            };

            if (data.newPassword !== data.confirmPassword) {
                showDialog('Mật khẩu xác nhận không khớp.', false);
                return;
            }

            fetch('/Profile/ChangePassword', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(res => res.json())
            .then(result => {
                showDialog(result.message, result.success);
                if (result.success) {
                    document.getElementById('changePasswordForm').reset();
                }
            });
        });
    </script>
}